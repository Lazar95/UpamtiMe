@using System.Web.Mvc
@helper Image(byte[] image, string m_type, string m_name)
{
    if (image != null)
    {
        var base64 = Convert.ToBase64String(image.ToArray());
        var imgSrc = String.Format("data:image/gif;base64,{0}", base64);
        <div @m_type="@m_name" style="background-image: url(@imgSrc)"></div>
    }
    else
    {
        <div @m_type="@m_name"></div>
    }
}

@helper Button(string type, string id, string icon, string text)
{ 
    <div class="@("button-" + type)" id=@id><div class="@("fa fa-"+icon)"></div><div>@text</div></div>
}

@helper LeaderboardEntry(int order, string username, double score, int userID, bool isHighlighted, UrlHelper url)
{
    <li class="@( isHighlighted ? " highlight" : "")">
        <div class="order">@order</div>
        <div class="avatar">
            <i class="fa fa-refresh"></i>
        </div>
        <div class="username"><a href="@url.Action("Profile", "Users", new {id = userID})">@username</a></div>
        <div class="score">@score</div>
    </li>
}

@helper LeaderboardEntryGeneral(int redniBr, Data.DTOs.LeaderboardEntryDTO lde, int? myUserID, string type, UrlHelper url)
{
    switch (type)
    {
        case "all-time-score": case "all-time-score-full": @Helper.LeaderboardEntry(redniBr++, lde.Username, lde.AllTimeScore, lde.UserID, myUserID != null && lde.UserID == myUserID, url); break;
        case "week-score": case "week-score-full": @Helper.LeaderboardEntry(redniBr++, lde.Username, lde.WeekScore, lde.UserID, myUserID != null && lde.UserID == myUserID, url); break;
        case "month-score": case "month-score-full": @Helper.LeaderboardEntry(redniBr++, lde.Username, lde.MonthScore, lde.UserID, myUserID != null && lde.UserID == myUserID, url); break;
    }
}

@helper Leaderboard(string type, List<Data.DTOs.LeaderboardEntryDTO> list, int? userID, int? limit, UrlHelper url, bool current = true)
{
    <ul id=@("leaderboard-" + type) class="@(current ? "current" : "")">
        @{
            if (limit == null)
            {
                limit = list.Count;
            }

            int redniBr = 1;

            int usersIndex = -1;
            if (userID != null)
            {
                usersIndex = list.FindIndex(a => a.UserID == userID);
            }

            if (usersIndex == -1 || usersIndex < limit)
            {
                foreach (Data.DTOs.LeaderboardEntryDTO lde in list.Take(limit.Value))
                {
                    @Helper.LeaderboardEntryGeneral(redniBr++, lde, userID, type, url)
                }
            }
            else
            {
                foreach (Data.DTOs.LeaderboardEntryDTO lde in list.Take(limit.Value - 1))
                {
                    @Helper.LeaderboardEntryGeneral(redniBr++, lde, userID, type, url)
                }
                @Helper.LeaderboardEntryGeneral(usersIndex, list[usersIndex], userID, type, url)
            }
        }
    </ul>
}

@helper LeaderboardTabs()
{
    <ul id="leaderboard-tabs">
        <li id="leaderboard-tabs-week" class="active">Nedelja</li>
        <li id="leaderboard-tabs-month">Mesec</li>
        <li id="leaderboard-tabs-all">Ukupno</li>
    </ul>
}
